{% extends "core/_base.html" %}
{% load leaflet_tags %}

{% block css %}
{% leaflet_js %}
{% leaflet_css %}
{% endblock css %}

{% block breadcrumb %}
<ol class="breadcrumb">
  <li><a href="#">Home</a></li>
  <li><a href="{% url 'projects_list' %}">Projects</a></li>
  <li class="active">{{ project.name }}</li>
</ol>
{% endblock breadcrumb %}

{% block header-text %}{{ project }} <small>{{ project.developer }}</small>
<a href="{% url 'project_update' project.id %}" type="button" class="btn btn-default">
  <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit details
</a>
<a href="{% url 'population_data_create' project.id %}" type="button" class="btn btn-info">
  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add population data
</a>
<a href="{% url 'population_data_create' project.id %}" type="button" class="btn btn-info">
  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add focal site data
</a>
<a href="{% url 'population_data_create' project.id %}" type="button" class="btn btn-info">
  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add fatality data
</a>
{% endblock %}

{% block content %}

{% leaflet_map "main" callback="main_map_init" %}

{% endblock content %}

{% block js %}
<script type="text/javascript">
function main_map_init(map, options) {
    // See http://blog.mathieu-leplatre.info/geodjango-maps-with-leaflet.html
    //console.log({{ turbine_locations|safe }})
    // Add the project polygon
    var project_polygon = new L.geoJson({% autoescape off %}{{ project_location }}{% endautoescape %});
    project_polygon.addTo(map);

    // Fit the map bounds to the project polygon
    map.fitBounds(project_polygon.getBounds());

    // Add the turbine points (if there are any)
    {% if turbine_locations %}
    var turbineIcon = new L.icon({
        iconUrl: '/static/core/img/icons/turbine-icon.png',
        shadowUrl: '/static/core/img/icons/turbine-shadow.png',

        iconSize:     [48, 63], // size of the icon
        shadowSize:   [48.4, 60], // size of the shadow
        iconAnchor:   [24.2, 60], // point of the icon which will correspond to marker's location
        shadowAnchor: [24.2, 60],  // the same for the shadow
        popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
    });
    var myStyle = {
        "color": "#ff7800",
        "weight": 5,
        "opacity": 0.65
    };

    var turbine_points = new L.geoJson({% autoescape off %}{{ turbine_locations }}{% endautoescape %}, {
      style: myStyle,
      pointToLayer: function(feature, latlng) {
          return L.marker(latlng, {icon: turbineIcon});
      },
    })
    turbine_points.addTo(map);
    {% endif %}

    // Add the solar... polygons?

    // Data points?
}
</script>
{% endblock js %}