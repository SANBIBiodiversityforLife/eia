{% extends "core/_base.html" %}
{% load leaflet_tags %}
{% load static %}

{% block css %}
{% leaflet_js %}
{% leaflet_css %}
{% endblock css %}

{% block breadcrumb %}
<ol class="breadcrumb">
  <li><a href="#">Home</a></li>
  <li><a href="{% url 'projects_list' %}">Projects</a></li>
  <li class="active">{{ project.name }}</li>
</ol>
{% endblock breadcrumb %}

{% block header-text %}{{ project }} <small>{{ project.developer }} - EIA: {{ project.eia_number }}</small>
  <a href="{% url 'project_update' project.id %}" type="button" class="btn btn-default">
    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit details
  </a>{% endblock %}

{% block content %}
<p>A {{ project.get_energy_type_display }} energy project,  <strong>developed by {{ project.developer }}</strong>.</p>
<ul>
  <li>Equipment details: "{{ project.equipment_make }}" make{% if project.equipment_height %}, standing
    {{ project.equipment_height }} m high{% endif %}{% if project.equipment_capacity %}, with a capacity of
    {{ project.equipment_capacity }} MW{% endif %}</li>
  {% if project.construction_date %}<li>{{ project.construction_date }}</li>{% endif %}
  {% if project.operational_date %}<li>{{ project.operational_date }}</li>{% endif %}
</ul>
{% leaflet_map "main" callback="main_map_init" %}
<hr>
<h2>Population data
  <a href="{% url 'population_data_create' project.id %}" type="button" class="btn btn-info">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add population data
  </a>
</h2>
{{ population_data.0.metadata }}
<table class="table table-striped">
  <thead>
    <tr>
      <th>Species</th>
      <th>Count</th>
      <th>Collision risk</th>
      <th>Density</th>
      <th>Passage rate</th>
    </tr>
  </thead>
  <tbody>
  {% for data in population_data %}
    <tr>
      <td>{{ data.taxa }}</td>
      <td>{{ data.count }}</td>
      <td>{{ data.collision_risk }}</td>
      <td>{{ data.density_km }}</td>
      <td>{{ data.passage_rate }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<h2>Focal site data
  <a href="{% url 'population_data_create' project.id %}" type="button" class="btn btn-info">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add focal site data
  </a>
</h2>
<h2>Fatality data
  <a href="{% url 'population_data_create' project.id %}" type="button" class="btn btn-info">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add fatality data
  </a>
</h2>
{% endblock content %}

{% block js %}
{% if turbine_locations %}<script src='{% static "core/js/leaflet_turbine_markers.js" %}'></script>{% endif %}
<script type="text/javascript">
function main_map_init(map, options) { // See http://blog.mathieu-leplatre.info/geodjango-maps-with-leaflet.html
    // Add the project polygon
    var project_polygon = new L.geoJson({% autoescape off %}{{ project_location }}{% endautoescape %});
    project_polygon.addTo(map);

    // Fit the map bounds to the project polygon
    map.fitBounds(project_polygon.getBounds());

    {% if turbine_locations %}
    // Add the turbine points (if there are any)
    var turbine_points = new L.geoJson({% autoescape off %}{{ turbine_locations }}{% endautoescape %}, {
      style: myStyle,
      pointToLayer: function(feature, latlng) {
          return L.marker(latlng, {icon: turbineIcon});
      },
    })
    turbine_points.addTo(map);
    {% endif %}

    // Add the solar... polygons?

    // Data points?
}
</script>
{% endblock js %}